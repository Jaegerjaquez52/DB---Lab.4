{% extends "base.html" %}

{% block title %}{{ title }}{% endblock %}

{% block content %}
<div class="page-header">
    <h1>{{ title }}</h1>
    {% if add_url %}
    <a href="{{ url_for(add_url) }}" class="btn btn-primary">‚ûï –î–æ–¥–∞—Ç–∏</a>
    {% endif %}
</div>

{% if items %}
<div class="table-responsive">
    <table class="data-table">
        <thead>
            <tr>
                {% for col in columns %}
                <th>{{ col }}</th>
                {% endfor %}
                
                {# –ó–ú–Ü–ù–ï–ù–û: –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ title –Ω–∞ 'üìù –ó–∞–º–æ–≤–ª–µ–Ω–Ω—è' –¥–ª—è —É–∑–≥–æ–¥–∂–µ–Ω–Ω—è –∑ app.py #}
                {% if title == 'üìù –ó–∞–º–æ–≤–ª–µ–Ω–Ω—è' %} 
                <th>–°—Ç–∞—Ç—É—Å</th>
                <th>–î—ñ—ó</th> {# –î–û–î–ê–ù–û: –ö–æ–ª–æ–Ω–∫–∞ –î—ñ—ó –¥–ª—è –ó–∞–º–æ–≤–ª–µ–Ω—å #}
                {% else %}
                {% if edit_url or delete_url or details_url %}
                <th>–î—ñ—ó</th>
                {% endif %}
                {% endif %}
                
            </tr>
        </thead>
        <tbody>
            {% for item in items %}
            <tr>
                {% for field in fields %}
                <td>
                    {% if field == 'price' or field == 'total_amount' or field == 'avg_order_value' or field == 'total_revenue' %}
                        {{ "%.2f"|format(item[field]) }} –≥—Ä–Ω
                    {% elif field == 'order_status' %}
                        <span class="badge badge-{{ item[field]|lower }}">{{ item[field] }}</span>
                    {% elif field == 'order_time' or field == 'created_at' or field == 'hire_date' %}
                        {{ item[field].strftime('%d.%m.%Y %H:%M') if item[field] else '-' }}
                    {% else %}
                        {{ item[field] }}
                    {% endif %}
                </td>
                {% endfor %}
                
                {# –ó–ú–Ü–ù–ï–ù–û: –¢–µ–ø–µ—Ä –¥–ª—è –ó–∞–º–æ–≤–ª–µ–Ω—å —î –æ–∫—Ä–µ–º–∞ –∫–æ–ª–æ–Ω–∫–∞ –¥–ª—è –°—Ç–∞—Ç—É—Å—É —Ç–∞ –æ–∫—Ä–µ–º–∞ –¥–ª—è –î—ñ–π #}
                {% if title == 'üìù –ó–∞–º–æ–≤–ª–µ–Ω–Ω—è' %}
                
                {# –ö–æ–ª–æ–Ω–∫–∞ –°—Ç–∞—Ç—É—Å #}
                <td>
                    <form method="POST" action="{{ url_for('update_order_status', order_id=item.order_id) }}" class="form-inline">
                        <select name="new_status" 
                                onchange="this.form.submit()" 
                                class="status-select status-select-{{ item.order_status|lower }}">
                            
                            {% set all_statuses = ['NEW', 'PREPARING', 'READY', 'PAID', 'CANCELLED'] %}
                            {% for status in all_statuses %}
                                <option value="{{ status }}" 
                                        {% if item.order_status == status %}selected{% endif %}>
                                    {{ status }}
                                </option>
                            {% endfor %}
                        </select>
                        <noscript><button type="submit" class="btn btn-small">–û–ö</button></noscript>
                    </form>
                </td>
                
                {# –ö–æ–ª–æ–Ω–∫–∞ –î—ñ—ó (Details + Delete) #}
                <td class="actions">
                    <a href="{{ url_for('orders_details', order_id=item.order_id) }}" 
                       class="btn btn-small btn-info">üëÅÔ∏è</a>
                       
                    <a href="{{ url_for('orders_delete', order_id=item.order_id) }}" 
                       class="btn btn-small btn-delete"
                       onclick="return confirm('–ü—ñ–¥—Ç–≤–µ—Ä–¥—ñ—Ç—å –≤–∏–¥–∞–ª–µ–Ω–Ω—è')">üóëÔ∏è</a>
                </td>
                
                {% elif edit_url or delete_url or details_url %}
                <td class="actions">
                    {% if details_url %}
                    <a href="{{ url_for(details_url, **{id_param: item[id_field]}) }}" 
                       class="btn btn-small btn-info">üëÅÔ∏è</a>
                    {% endif %}
                    
                    {% if edit_url %}
                    <a href="{{ url_for(edit_url, **{id_param: item[id_field]}) }}" 
                       class="btn btn-small btn-edit">‚úèÔ∏è</a>
                    {% endif %}
                    
                    {% if delete_url %}
                    <a href="{{ url_for(delete_url, **{id_param: item[id_field]}) }}" 
                       class="btn btn-small btn-delete"
                       onclick="return confirm('–ü—ñ–¥—Ç–≤–µ—Ä–¥—ñ—Ç—å –≤–∏–¥–∞–ª–µ–Ω–Ω—è')">üóëÔ∏è</a>
                    {% endif %}
                </td>
                {% endif %}
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>
<p class="table-info">–í—Å—å–æ–≥–æ –∑–∞–ø–∏—Å—ñ–≤: {{ items|length }}</p>
{% else %}
<div class="empty-state">
    <p>–î–∞–Ω–∏—Ö –ø–æ–∫–∏ –Ω–µ–º–∞—î</p>
    {% if add_url %}
    <a href="{{ url_for(add_url) }}" class="btn btn-primary">–î–æ–¥–∞—Ç–∏ –ø–µ—Ä—à–∏–π –∑–∞–ø–∏—Å</a>
    {% endif %}
</div>
{% endif %}
{% endblock %}