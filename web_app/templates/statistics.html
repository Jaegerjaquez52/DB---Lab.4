{% extends "base.html" %}

{% block title %}–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞{% endblock %}

{% block content %}
<div class="page-header">
    <h1>–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Ç–∞ –∑–≤—ñ—Ç–∏</h1>
</div>

{# --- –ë–õ–û–ö 1: –ó–í–Ü–¢ –ó–ê 30 –î–ù–Ü–í --- #}
{% if last_30_days %}
<div class="section">
    <h2>üìÖ –ó–≤—ñ—Ç –∑–∞ –æ—Å—Ç–∞–Ω–Ω—ñ 30 –¥–Ω—ñ–≤</h2>
    <div class="stats-grid">
        
        <div class="stat-card success">
            <div class="stat-icon">üí∞</div>
            <div class="stat-content">
                <h3>{{ "%.2f"|format(last_30_days.total_revenue) }} –≥—Ä–Ω</h3>
                <p>–ß–∏—Å—Ç–∞ –≤–∏—Ä—É—á–∫–∞</p>
            </div>
        </div>
        
        <div class="stat-card">
            <div class="stat-icon">üßæ</div>
            <div class="stat-content">
                <h3>{{ last_30_days.total_orders }}</h3>
                <p>–í—Å—å–æ–≥–æ –∑–∞–º–æ–≤–ª–µ–Ω—å</p>
            </div>
        </div>

        <div class="stat-card highlight">
            <div class="stat-icon">üìà</div>
            <div class="stat-content">
                <h3>{{ "%.2f"|format(last_30_days.avg_order_value) }} –≥—Ä–Ω</h3>
                <p>–°–µ—Ä–µ–¥–Ω—ñ–π —á–µ–∫</p>
            </div>
        </div>

        <div class="stat-card">
            <div class="stat-icon">‚ùå</div>
            <div class="stat-content">
                <h3>{{ last_30_days.cancelled_orders }}</h3>
                <p>–°–∫–∞—Å–æ–≤–∞–Ω–æ</p>
            </div>
        </div>

    </div>
</div>
{% endif %}

{# --- –ë–õ–û–ö 2: –¢–û–ü –°–¢–†–ê–í --- #}
<div class="section">
    {# –ó–∞–≥–æ–ª–æ–≤–æ–∫ —Å–µ–∫—Ü—ñ—ó –∑ –∫–Ω–æ–ø–∫–æ—é –ø—Ä–∞–≤–æ—Ä—É—á #}
    <div style="display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid var(--border-light); margin-bottom: 15px; padding-bottom: 10px;">
        <h2 style="border-bottom: none; margin-bottom: 0; padding-bottom: 0;">–¢–æ–ø –ø–æ–ø—É–ª—è—Ä–Ω–∏—Ö —Å—Ç—Ä–∞–≤</h2>
        
        {% if session.role == '–ê–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–æ—Ä' %}
            <a href="{{ url_for('download_dishes_report') }}" class="btn btn-info btn-small" title="–ó–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ CSV">
                üì• –ó–≤—ñ—Ç: –°—Ç—Ä–∞–≤–∏
            </a>
        {% endif %}
    </div>

    {% if popular_dishes %}
    <table class="data-table">
        <thead>
            <tr>
                <th>–°—Ç—Ä–∞–≤–∞</th>
                <th>–ö–∞—Ç–µ–≥–æ—Ä—ñ—è</th>
                <th>–ó–∞–º–æ–≤–ª–µ–Ω–æ —Ä–∞–∑—ñ–≤</th>
                <th>–í–∏—Ä—É—á–∫–∞</th>
            </tr>
        </thead>
        <tbody>
            {% for dish in popular_dishes %}
            <tr>
                <td>{{ dish.menu_item_name }}</td>
                <td>{{ dish.category }}</td>
                <td>{{ dish.times_ordered }}</td>
                <td>{{ "%.2f"|format(dish.total_revenue) }} –≥—Ä–Ω</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
    {% else %}
        <p>–î–∞–Ω–∏—Ö –Ω–µ–º–∞—î.</p>
    {% endif %}
</div>

{# --- –ë–õ–û–ö 3: –°–¢–ê–¢–ò–°–¢–ò–ö–ê –ü–†–ê–¶–Ü–í–ù–ò–ö–Ü–í --- #}
<div class="section">
    {# –ó–∞–≥–æ–ª–æ–≤–æ–∫ —Å–µ–∫—Ü—ñ—ó –∑ –∫–Ω–æ–ø–∫–æ—é –ø—Ä–∞–≤–æ—Ä—É—á #}
    <div style="display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid var(--border-light); margin-bottom: 15px; padding-bottom: 10px;">
        <h2 style="border-bottom: none; margin-bottom: 0; padding-bottom: 0;">–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø—Ä–∞—Ü—ñ–≤–Ω–∏–∫—ñ–≤</h2>
        
        {% if session.role == '–ê–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–æ—Ä' %}
            <a href="{{ url_for('download_revenue_report') }}" class="btn btn-info btn-small" title="–ó–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ CSV">
                üì• –ó–≤—ñ—Ç: –ü—Ä–∞—Ü—ñ–≤–Ω–∏–∫–∏
            </a>
        {% endif %}
    </div>

    {% if employee_stats %}
    <table class="data-table">
        <thead>
            <tr>
                <th>–ü—Ä–∞—Ü—ñ–≤–Ω–∏–∫</th>
                <th>–ü–æ—Å–∞–¥–∞</th>
                <th>–ó–∞–º–æ–≤–ª–µ–Ω—å</th>
                <th>–í–∏—Ä—É—á–∫–∞</th>
            </tr>
        </thead>
        <tbody>
            {% for emp in employee_stats %}
            <tr>
                <td>{{ emp.employee_name }}</td>
                <td>{{ emp.position }}</td>
                <td>{{ emp.total_orders }}</td>
                <td>{{ "%.2f"|format(emp.total_revenue) }} –≥—Ä–Ω</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
    {% else %}
        <p>–î–∞–Ω–∏—Ö –Ω–µ–º–∞—î.</p>
    {% endif %}
</div>
{% endblock %}